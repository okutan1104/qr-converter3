<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰â†’QRå¤‰æ›ãƒ„ãƒ¼ãƒ«</title>
<script src="https://unpkg.com/@zxing/library@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<style>
body {
  font-family: system-ui, sans-serif;
  background: #f8fafc;
  padding: 1.5rem;
  text-align: center;
}
#camera {
  width: 320px;
  height: 240px;
  background: #000;
  border-radius: 8px;
}
#qrcode {
  margin-top: 1rem;
}
button {
  margin: 0.5rem;
  padding: 0.7rem 1.5rem;
  border: none;
  border-radius: 8px;
  background: #007bff;
  color: white;
  font-size: 1rem;
}
#barcodeResult {
  font-size: 1.1rem;
  margin-top: 0.5rem;
  color: #333;
}
</style>
</head>
<body>

<h2>ğŸ“¦ ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ â†’ QRã‚³ãƒ¼ãƒ‰å¤‰æ›ãƒ„ãƒ¼ãƒ«</h2>
<video id="camera" autoplay muted></video>
<p id="barcodeResult">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ã‹ã–ã—ã¦ãã ã•ã„</p>

<div id="qrcode"></div>
<button id="startBtn">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰èª­å–ã‚Šé–‹å§‹</button>
<button id="stopBtn">åœæ­¢</button>

<script>
const codeReader = new ZXing.BrowserMultiFormatReader();
const videoElement = document.getElementById('camera');
const resultElement = document.getElementById('barcodeResult');
const qrContainer = document.getElementById('qrcode');

async function startBarcodeScanner() {
  try {
    const devices = await codeReader.listVideoInputDevices();
    const selectedDeviceId = devices[0]?.deviceId;

    await codeReader.decodeFromVideoDevice(selectedDeviceId, videoElement, (result, err) => {
      if (result) {
        const barcodeText = result.getText();
        resultElement.textContent = 'èª­å–çµæœï¼š' + barcodeText;

        // QRç”Ÿæˆå‰ã«ã‚¯ãƒªã‚¢
        qrContainer.innerHTML = '';
        new QRCode(qrContainer, {
          text: barcodeText,
          width: 200,
          height: 200,
        });
      }
      if (err && !(err instanceof ZXing.NotFoundException)) {
        console.error(err);
      }
    });
  } catch (e) {
    console.error(e);
    resultElement.textContent = 'ã‚«ãƒ¡ãƒ©ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
  }
}

function stopBarcodeScanner() {
  codeReader.reset();
  resultElement.textContent = 'åœæ­¢ã—ã¾ã—ãŸã€‚';
}

document.getElementById('startBtn').addEventListener('click', startBarcodeScanner);
document.getElementById('stopBtn').addEventListener('click', stopBarcodeScanner);
</script>

</body>
</html>
